<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- Include Bootstrap JavaScript and jQuery -->


<style>
    /* Adjust the width of both buttons and give them equal margin */
    .custom-btn {
        width: 50%;
        /* Customize the width as needed */
        margin-right: 5px;
        /* Adjust the margin as needed */
        margin-left: 5px;
        /* Adjust the margin as needed */
    }

    .credit-description {
        color: green;
    }

    .debit-description {
        color: red;
    }

    /* Change the background color of the "Cancel Order" button */
    .cancel-btn {
        background-color: #ff0000;
        /* Change to your desired color */
        color: #fff;
        /* Text color */
    }

    /* Add any additional styling for the spinner if needed */
    #spinner {
        margin-right: 5px;
    }

    #shareBtn {
        letter-spacing: 2px;
        font-weight: 600;
        box-shadow: none;
        background-color: #eee;
        color: #7d2ae8;
        border: none;
    }

    .modal {
        top: 20%;
    }

    .btn-close {
        box-shadow: none;
        border: none;
        outline: none;
    }

    .modal-body .icons {
        margin: 15px 0px 20px 0px;
    }

    .modal-body .icons a {
        text-decoration: none;
        border: 1px solid transparent;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 20px;
        transition: all 0.3s ease-in-out;
    }

    .modal-body .icons a:nth-child(1) {
        color: #1877F2;
        border-color: #B7D4FB;
    }

    .modal-body .icons a:nth-child(1):hover {
        background-color: #1877F2;
        color: #fff;
    }

    .modal-body .icons a:nth-child(2) {
        color: #46C1F6;
        border-color: #b6e7fc;
    }

    .modal-body .icons a:nth-child(2):hover {
        background-color: #46C1F6;
        color: #fff;
    }

    .modal-body .icons a:nth-child(3) {
        color: #e1306c;
        border-color: #f5bccf;
    }

    .modal-body .icons a:nth-child(3):hover {
        background-color: #e1306c;
        color: #fff;
    }

    .modal-body .icons a:nth-child(4) {
        color: #25d366;
        border-color: #bef4d2;
    }

    .modal-body .icons a:nth-child(4):hover {
        background-color: #25d366;
        color: #fff;
    }


    .modal-body .icons a:nth-child(5) {
        color: #0088cc;
        border-color: #b3e6ff;
    }

    .modal-body .icons a:nth-child(5):hover {
        background-color: #0088cc;
        color: #fff;
    }

    .modal-body .icons a:hover {
        border-color: transparent;
    }

    .modal-body .icons a span {
        transition: all 0.09s ease-in-out;
    }

    .modal-body .icons a:hover span {
        transform: scaleX(1.1);
    }

    .modal-body .field {
        margin: 15px 0px -5px 0px;
        height: 45px;
        border: 1px solid #dfdfdf;
        border-radius: 5px;
        padding: 0 5px;
    }

    .modal-body .field.active {
        border-color: #7d2ae8;
    }

    .field span {
        width: 50px;
        font-size: 1.1rem;
    }

    .field.active span {
        color: #7d2ae8;
    }

    .field input {
        border: none;
        outline: none;
        font-size: 0.89rem;
        width: 100%;
        height: 100%;
    }

    .field button {
        padding: 5px 16px;
        color: #fff;
        background: #7d2ae8;
        border: 2px solid transparent;
        border-radius: 5px;
        font-weight: 500;
    }

    @media (max-width: 330px) {
        .modal-body .icons a {
            margin-right: 15px;
            width: 35px;
            height: 35px;
        }
    }

    .error-box {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        background-color: #000;
        /* Black background color */
        color: #fff;
        /* White text color */
        padding: 10px 20px;
        border-radius: 4px;
        z-index: 999;
        transition: top 0.5s ease-in-out;
    }

    .success-box {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        background-color: #000;
        /* Black background color */
        color: #fff;
        /* White text color */
        padding: 10px 20px;
        border-radius: 4px;
        z-index: 999;
        transition: top 0.5s ease-in-out;
    }

    .slide-in {
        top: 50px;
    }

    .wallet-container {
        background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
            url(https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTjOvSperRYjHH9-EHlKZJBfwvXy4rJpyerzHQsnp8DuuycYU5_);
        width: 100%;
        color: #fff;
        font-size: 15px;
        padding: 20px 20px 0;


    }

    .page-title {
        text-align: left;
    }

    .fa-user {
        float: right;
    }

    .fa-align-left {
        margin-right: 15px;
    }

    .amount-box img {
        width: 50px;
    }

    .amount {
        font-size: 35px;
    }

    .amount-box p {
        margin-top: 10px;
        margin-bottom: -10px;
    }

    .btn-group {
        margin: 20px 0;
    }

    .btn-group .btn {
        margin: 8px;
        border-radius: 20px !important;
        font-size: 12px;
    }

    .txn-history {
        text-align: left;
    }

    .txn-list {
        background-color: #fff;
        padding: 12px 10px;
        color: #777;
        font-size: 14px;
        margin: 7px 0;
    }

    .debit-amount {
        color: red;
        float: right;
    }

    .credit-amount {
        color: green;
        float: right;
    }

    .footer-menu {

        bottom: 0;
        border-top: 1px solid #ccc;
        padding: 10px 10px 0;
    }

    @media screen and (max-width: 800px) {
        .wallet-container {
            height: 100%;
            bottom: 20px;
            margin-top: 100px;
        }
    }

    .dots {
        position: absolute;
        height: 17px;
        width: 17px;
        background-color: red;
        border-radius: 50%;
        bottom: 16px;
        right: 143px;
        font-size: 10px;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .earn-text {
        font-size: 13px;
    }


    .form-control {
        height: 40px;
        font-size: 14px;
    }
</style>

 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<%- include('userSidePartials/UserHeader',{user}) %>

<%- include('userSidePartials/UserMobileHeader') %>

<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Pages
                <span></span> Account
            </div>
        </div>
    </div>
    <section class="pt-150 pb-150">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 m-auto">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="dashboard-menu">
                                <ul class="nav flex-column" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                            href="#dashboard" role="tab" aria-controls="dashboard"
                                            aria-selected="false"><i
                                                class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="Edit-Profile-tab" data-bs-toggle="tab"
                                            href="#Edit-Profile" role="tab" aria-controls="Edit-Profile"
                                            aria-selected="true"><i class="fi-rs-user mr-10"></i>Edit Account</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                            role="tab" aria-controls="orders" aria-selected="false"><i
                                                class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                    </li>
                                    <!-- <li class="nav-item">
                                        <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order</a>
                                    </li> -->
                                    <li class="nav-item">
                                        <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                            role="tab" aria-controls="address" aria-selected="true"><i
                                                class="fi-rs-marker mr-10"></i>My Address</a>
                                    </li>
                                    <!-- <li class="nav-item">
                                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                            href="#account-detail" role="tab" aria-controls="account-detail"
                                            aria-selected="true"><i class="fi-rs-user mr-10"></i>Account details</a>
                                    </li> -->
                                    <li class="nav-item">
                                        <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail" role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Personal Wallet</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="Share-link-tab" data-bs-toggle="tab" href="#referralTab" role="tab" aria-controls="referralTab" aria-selected="true"><i class="fi-rs-user mr-10"></i>Referrals</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="/logout"><i
                                                class="fi-rs-sign-out mr-10"></i>Logout</a>
                                    </li>
                                </ul>
                            </div>
                        </div>



                        <div class="col-md-8">
                            <div class="tab-content dashboard-content">


                                <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                    aria-labelledby="dashboard-tab">
                                    <div class="card">

                                        <div class="rounded-top text-white d-flex flex-row"
                                            style="background-color: #b3e2da; height:200px;">
                                            <div class="ms-4 mt-5 d-flex flex-column" style="width: 150px;">
                                                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-profiles/avatar-1.webp"
                                                    alt="Generic placeholder image"
                                                    class="img-fluid img-thumbnail mt-4 mb-2"
                                                    style="width: 150px; z-index: 1">
                                               
                                            </div>
                                            <div class="ms-3" style="margin-top: 130px;">
                                                <h4><%= userDetails.name %></h4>
                                                <p></p>
                                            </div>
                                        </div>
                                        <div class="p-4 text-black" style="background-color: #f8f9fa;">
                                            <div class="justify-content-center text-center py-1"
                                                style="margin-top: 50px;">

                                                <h4>Profile Details</h4>

                                                <div class="d-flex justify-content-center ">

                                                    <div class="table-responsive w-100 border-0 bg-transparent"
                                                        style="border: none;">
                                                        <table class="table mb-0 border-0 text-md-center"
                                                            style="border: none;">

                                                            <tbody>
                                                                <tr>
                                                                    <td>Name </td>
                                                                    <td><%= userDetails.name %></td>
                                                                </tr>
            
                                                                <tr>
                                                                    <td>Email </td>
                                                                    <td><%= userDetails.email %></td>
                                                                </tr>
                                                                <!-- <tr>
                                                                    <td>Gender </td>
                                                                    <td><%= //userDetails.gender %></td>
                                                                </tr> -->
                                                                <tr>
                                                                    <td>Mobile </td>
                                                                    <td><%= userDetails.mobile %></td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>


                                                </div>

                                                <!-- //Change password / -->
                                                <div class="row mt-4 w-75 mx-auto ">
                                                    <button type="button" id="changePasswordbtn" class="btn">Change
                                                        Password</button>
                                                </div>

                                            </div>
                                        </div>


                                    </div>
                                </div>

                                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                    <div class="row" style="border: 1px solid black; background: rgb(240, 239, 239);">
                                        <div class="col">
                                            <div id="orders-container"></div>
                                
                                            <div class="pagination-area">
                                                <nav aria-label="Page navigation">
                                                    <ul id="pagination" class="pagination justify-content-center">
                                                        <!-- Pagination links will be appended here -->
                                                    </ul>
                                                </nav>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                    aria-labelledby="track-orders-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0">Orders tracking</h5>
                                        </div>
                                        <div class="card-body contact-from-area">
                                            <p>To track your order please enter your OrderID in the box below and press
                                                "Track" button. This was given to you on your receipt and in the
                                                confirmation email you should have received.</p>
                                            <div class="row">
                                                <div class="col-lg-8">
                                                    <form class="contact-form-style mt-30 mb-50" action="#"
                                                        method="post">
                                                        <div class="input-style mb-20">
                                                            <label>Order ID</label>
                                                            <input name="order-id"
                                                                placeholder="Found in your order confirmation email"
                                                                type="text" class="square">
                                                        </div>
                                                        <div class="input-style mb-20">
                                                            <label>Billing email</label>
                                                            <input name="billing-email"
                                                                placeholder="Email you used during checkout"
                                                                type="email" class="square">
                                                        </div>
                                                        <button class="submit submit-auto-width"
                                                            type="submit">Track</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                    <!-- Button to trigger the modal -->
                                    <div class="row d-flex justify-content-end mb-4">
                                        <button class="btn btn-primary" id="openModalButton" data-toggle="modal"
                                            data-target="#addressModal">Add Address</button>
                                    </div>

                                    <!-- The modal -->
                                    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog"
                                        aria-labelledby="addressModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content modal-dialog-scrollable">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="addressModalLabel">Add Address</h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <!-- Your form content goes here -->
                                                    <form id="addressForm">
                                                        <!-- Form fields for address details -->
                                                        <div class="form-group mb-3">
                                                            <label for="addressType">Address Type</label>
                                                            <select class="form-control" id="addressType"
                                                                name="addressType">
                                                                <option value="home">Home</option>
                                                                <option value="work">Work</option>
                                                                <option value="temp">Temporary</option>
                                                            </select>
                                                            <span id="addressTypeError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="houseNo">House No</label>
                                                            <input type="text" class="form-control" id="houseNo"
                                                                placeholder="House Number">
                                                            <span id="houseNoError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="street">Street</label>
                                                            <input type="text" class="form-control" id="street"
                                                                placeholder="Street">
                                                            <span id="streetError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="landmark">Landmark</label>
                                                            <input type="text" class="form-control" id="landmark"
                                                                placeholder="Landmark">

                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="pincode">Pincode</label>
                                                            <input type="number" class="form-control" id="pincode"
                                                                placeholder="Pincode">
                                                            <span id="pincodeError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="city">City</label>
                                                            <input type="text" class="form-control" id="city"
                                                                placeholder="City">
                                                            <span id="cityError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="district">District</label>
                                                            <input type="text" class="form-control" id="district"
                                                                placeholder="district">
                                                            <span id="districtError" class="text-danger"></span>
                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="state" class="mb-2 d-block">State</label>
                                                            <select id="state" class="form-control border" name="state">
                                                                <option value=""></option>
                                                                <!-- Your state options will be dynamically added here -->
                                                            </select>
                                                            <span id="stateError" class="text-danger"></span>

                                                        </div>
                                                        <div class="form-group mb-3">
                                                            <label for="country">Country</label>
                                                            <input type="text" class="form-control" id="country"
                                                                placeholder="Country">
                                                            <span id="countryError" class="text-danger"></span>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Close</button>

                                                    <button type="button" class="btn btn-primary"
                                                        id="saveAddress">Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <% if(addresses && addresses.addresses.length>0){ %>
                                        <% addresses.addresses.forEach((item,index)=>{ %>
                                        <div class="col-lg-12">
                                            <div class="card">
                                                <% if(item.addressType=== 'temp' ){ %>
                                                <div class="card-header">
                                                    <h5 class="mb-0">Temporary Address</h5>
                                                </div>
                                                <% }else{ %>
                                                <div class="card-header">
                                                    <h5 class="mb-0"><%= item.addressType.toUpperCase() %> Address</h5>
                                                </div>
                                                <% } %>
                                                <div class="card-body">
                                                    <address>
                                                        <%= item.HouseNo %> <%= item.Street %><br>
                                                        <%= item.city %>, <%= item.State %> <%= item.pincode %>
                                                        <%= item.Country %><br>

                                                    </address>
                                                    <p><%= item.district %></p>
                                                </div>
                                                <div class="card-footer d-flex  justify-content-between">
                                                    <button class="btn" data-toggle="modal"
                                                        data-target="#editAddressModal<%= index %>"
                                                        data-index="<%= index %>">Edit</button>
                                                    <button class="btn" type="button"
                                                        onclick="addressRemove('<%= item.addressType  %>')">Remove</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Modal for Editing Address -->
                                        <div class="modal" id="editAddressModal<%= index %>">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title">Edit Address</h5>
                                                        <button type="button" class="close"
                                                            data-dismiss="modal">&times;</button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="editaddressForm" action="/profile/editAddress"
                                                            method="post">
                                                            <!-- Form fields for address details -->
                                                            <div class="form-group mb-3">
                                                                <label for="addressType">Address Type</label>
                                                                <select class="form-control" id="editAddressType"
                                                                    value="<%= item.addressType %>" name="addressType"
                                                                    required>
                                                                    <option value="home"
                                                                        <% if (item.addressType === 'home') { %>selected<% } %>>
                                                                        Home</option>
                                                                    <option value="work"
                                                                        <% if (item.addressType === 'work') { %>selected<% } %>>
                                                                        Work</option>
                                                                    <option value="temp"
                                                                        <% if (item.addressType === 'temp') { %>selected<% } %>>
                                                                        Temporary</option>
                                                                </select>
                                                                <span id="addressTypeError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="houseNo">House No</label>
                                                                <input type="text" class="form-control" id="editHouseNo"
                                                                    required name="HouseNo" value="<%= item.HouseNo %>"
                                                                    placeholder="House Number">
                                                                <span id="edithouseNoError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="street">Street</label>
                                                                <input type="text" class="form-control" id="editStreet"
                                                                    required name="Street" value="<%= item.Street %>"
                                                                    placeholder="Street">
                                                                <span id="editstreetError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="landmark">Landmark</label>
                                                                <input type="text" class="form-control" id="landmark"
                                                                    name="Landmark" placeholder="Landmark">

                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="pincode">Pincode</label>
                                                                <input type="number" class="form-control" id="pincode"
                                                                    required name="pincode" value="<%= item.pincode %>"
                                                                    placeholder="Pincode">
                                                                <span id="editpincodeError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="city">City</label>
                                                                <input type="text" class="form-control" id="city"
                                                                    name="city" required value="<%= item.city %>"
                                                                    placeholder="City">
                                                                <span id="editcityError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="district">District</label>
                                                                <input type="text" class="form-control" id="district"
                                                                    required value="<%= item.district %>"
                                                                    name="district" placeholder="district">
                                                                <span id="editdistrictError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="state" class="mb-2 d-block">State</label>
                                                                <select id="state" class="form-control border" required
                                                                    name="state">
                                                                    <option value="">Select A State</option>
                                                                    <option value="Andhra Pradesh"
                                                                        <% if (item.State === 'Andhra Pradesh') { %>selected<% } %>>
                                                                        Andhra Pradesh</option>
                                                                    <option value="Arunachal Pradesh"
                                                                        <% if (item.State === 'Arunachal Pradesh') { %>selected<% } %>>
                                                                        Arunachal Pradesh</option>
                                                                    <option value="Assam"
                                                                        <% if (item.State === 'Assam') { %>selected<% } %>>
                                                                        Assam</option>
                                                                    <option value="Bihar"
                                                                        <% if (item.State === 'Bihar') { %>selected<% } %>>
                                                                        Bihar</option>
                                                                    <option value="Chhattisgarh"
                                                                        <% if (item.State === 'Chhattisgarh') { %>selected<% } %>>
                                                                        Chhattisgarh</option>
                                                                    <option value="Goa"
                                                                        <% if (item.State === 'Goa') { %>selected<% } %>>
                                                                        Goa</option>
                                                                    <option value="Gujarat"
                                                                        <% if (item.State === 'Gujarat') { %>selected<% } %>>
                                                                        Gujarat</option>
                                                                    <option value="Haryana"
                                                                        <% if (item.State === 'Haryana') { %>selected<% } %>>
                                                                        Haryana</option>
                                                                    <option value="Himachal Pradesh"
                                                                        <% if (item.State === 'Himachal Pradesh') { %>selected<% } %>>
                                                                        Himachal Pradesh</option>
                                                                    <option value="Jharkhand"
                                                                        <% if (item.State === 'Jharkhand') { %>selected<% } %>>
                                                                        Jharkhand</option>
                                                                    <option value="Karnataka"
                                                                        <% if (item.State === 'Karnataka') { %>selected<% } %>>
                                                                        Karnataka</option>
                                                                    <option value="Kerala"
                                                                        <% if (item.State === 'Kerala') { %>selected<% } %>>
                                                                        Kerala</option>
                                                                    <option value="Madhya Pradesh"
                                                                        <% if (item.State === 'Madhya Pradesh') { %>selected<% } %>>
                                                                        Madhya Pradesh</option>
                                                                    <option value="Maharashtra"
                                                                        <% if (item.State === 'Maharashtra') { %>selected<% } %>>
                                                                        Maharashtra</option>
                                                                    <option value="Manipur"
                                                                        <% if (item.State === 'Manipur') { %>selected<% } %>>
                                                                        Manipur</option>
                                                                    <option value="Meghalaya"
                                                                        <% if (item.State === 'Meghalaya') { %>selected<% } %>>
                                                                        Meghalaya</option>
                                                                    <option value="Mizoram"
                                                                        <% if (item.State === 'Mizoram') { %>selected<% } %>>
                                                                        Mizoram</option>
                                                                    <option value="Nagaland"
                                                                        <% if (item.State === 'Nagaland') { %>selected<% } %>>
                                                                        Nagaland</option>
                                                                    <option value="Odisha"
                                                                        <% if (item.State === 'Odisha') { %>selected<% } %>>
                                                                        Odisha</option>
                                                                    <option value="Punjab"
                                                                        <% if (item.State === 'Punjab') { %>selected<% } %>>
                                                                        Punjab</option>
                                                                    <option value="Rajasthan"
                                                                        <% if (item.State === 'Rajasthan') { %>selected<% } %>>
                                                                        Rajasthan</option>
                                                                    <option value="Sikkim"
                                                                        <% if (item.State === 'Sikkim') { %>selected<% } %>>
                                                                        Sikkim</option>
                                                                    <option value="Tamil Nadu"
                                                                        <% if (item.State === 'Tamil Nadu') { %>selected<% } %>>
                                                                        Tamil Nadu</option>
                                                                    <option value="Telangana"
                                                                        <% if (item.State === 'Telangana') { %>selected<% } %>>
                                                                        Telangana</option>
                                                                    <option value="Tripura"
                                                                        <% if (item.State === 'Tripura') { %>selected<% } %>>
                                                                        Tripura</option>
                                                                    <option value="Uttar Pradesh"
                                                                        <% if (item.State === 'Uttar Pradesh') { %>selected<% } %>>
                                                                        Uttar Pradesh</option>
                                                                    <option value="Uttarakhand"
                                                                        <% if (item.State === 'Uttarakhand') { %>selected<% } %>>
                                                                        Uttarakhand</option>
                                                                    <option value="West Bengal"
                                                                        <% if (item.State === 'West Bengal') { %>selected<% } %>>
                                                                        West Bengal</option>
                                                                    <!-- Add more states as needed -->
                                                                </select>
                                                                <span id="editstateError" class="text-danger"></span>
                                                            </div>
                                                            <div class="form-group mb-3">
                                                                <label for="country">Country</label>
                                                                <input type="text" required class="form-control"
                                                                    id="country" value="<%= item.Country %>"
                                                                    name="Country" placeholder="Country">
                                                                <span id="editcountryError" class="text-danger"></span>
                                                            </div>
                                                            <!-- Other address fields here... -->

                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="submit" class="btn btn-primary">Save</button>
                                                        <button type="button" class="btn btn-secondary"
                                                            data-dismiss="modal">Close</button>
                                                    </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <% }) %>
                                        <% }else{ %>
                                        <div class="col-lg-12">
                                            <h5>Not Address Found</h5>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>

                             <!--    Wallet     -->



                             <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="wallet-container text-center">
                                            <p class="page-title text-white"><i class="fa fa-align-left text-danger"></i>My E-wallet<i class="fa fa-user text-danger "></i></p>
                                            <% if (userDetails.WalletDetails.length > 0) { %>
                                                <div class="amount-box text-center">
                                                <img src="https://lh3.googleusercontent.com/ohLHGNvMvQjOcmRpL4rjS3YQlcpO0D_80jJpJ-QA7-fQln9p3n7BAnqu3mxQ6kI4Sw" alt="wallet">
                                                <p class="text-white">Total Balance</p>
                                                <% if (userDetails && userDetails.WalletDetails) { %>
                                                    <p class="amount text-white ">₹ <%= userDetails.WalletDetails[0].balance %></p>
                                                <% } else { %>
                                                    <p class="amount">₹ 0.00</p>
                                                <% } %>
                                            </div>
                            
                                            <div class="btn-group text-center">
                                                <button type="button" class="btn btn-outline-light" onclick="addMoneyToWallet('<%= userDetails._id %>')">Add Money</button>
                                                <button onclick="showWithdrawalPrompt('<%= userDetails.WalletDetails ? userDetails.WalletDetails[0].balance : 0 %>')" class="btn btn-outline-light">Withdraw</button>
                                            </div>
                            
                                            <div class="txn-history">
                                                        <p><b>History</b></p>
                                                        <% userDetails.WalletDetails[0].transactions.slice().reverse().forEach((transaction,index)=>{  %>
                                                            <% if(index<5){ %>
                                                                <p class="txn-list">
                                                                    <% if (transaction.type === 'debit') { %>
                                                                      Debited <span class="debit-amount">-₹<%= Math.abs(transaction.amount) %></span>
                                                                      <% if (transaction.description) { %>
                                                                        <span class="debit-description">- <%= transaction.description %></span>
                                                                      <% } %>
                                                                    <% } else if (transaction.type === 'credit') { %>
                                                                      Credited <span class="credit-amount">+₹<%= transaction.amount %></span>
                                                                      <% if (transaction.description) { %>
                                                                        <span class="credit-description">+ <%= transaction.description %></span>
                                                                      <% } %>
                                                                    <% } %>
                                                                  </p>
                                                                  
                                                        <% } %>
                                                            <% }) %>
                                                    </div>
                                                    <% } else { %>
                                                      <p>No wallet details available.</p>
                                                    <% } %>
                                                    <div class="footer-menu"></div>
                                        
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                                <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                    aria-labelledby="account-detail-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Account Details</h5>
                                        </div>
                                        <div class="card-body">

                                        </div>
                                    </div>
                                </div>

                                
                         

                                <div class="tab-pane fade" id="referralTab" role="tabpanel"
                                aria-labelledby="track-orders-tab">
                                <div class="card">
                                    <div class="card p-3 text-center">

                                        <div class="position-relative">

                                            <img src="https://i.imgur.com/iicvsZ6.png">
                                            <!-- <span class="dots"><i class="fa fa-plus"></i></span> -->
                                        </div>

                                        <div>
                                            <h5>Invite & Earn</h5>
                                            <span class="earn-text">Be a trendsetter! Introduce your circle
                                                to the next big thing Shopee. <br> Your influence, your
                                                rewards</span>
                                        </div>


                                        <div class="px-3 mt-2">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span>₹0</span>
                                                <span>₹500</span>
                                            </div>
                                            <div class="progress" style="height:4px;">
                                                <div class="progress-bar bg-danger" role="progressbar"
                                                    style="width: 50%" aria-valuenow="50" aria-valuemin="0"
                                                    aria-valuemax="100"></div>
                                            </div>

                                        </div>

                                        <div class="px-3 mt-2 d-flex justify-content-end ">

                                            <button type="button" class="btn btn-primary text-uppercase"
                                                data-bs-toggle="modal" data-bs-target="#myModel"
                                                id="shareBtn" data-bs-placement="top" title="Click Me!">
                                                Share
                                            </button>
                                        </div>



                                        <div
                                            class="mt-3 px-3 d-flex justify-content-between align-items-center">




                                        </div>




                                    </div>
                                </div>
                            </div>




                                <!-- Edit Profile -->
                                <div class="tab-pane fade" id="Edit-Profile" role="tabpanel"
                                    aria-labelledby="Edit-Profile-tab">
                                    <div class="card border-0">
                                        <div class="card-header bg-transparent text-center">
                                            <h5 class="mb-0">Edit Account</h5>
                                        </div>
                                        <form id="editprofile">
                                            <!-- 2 column grid layout with text inputs for the first and last names -->
                                            <div class="row mb-4">
                                                <div class="col">
                                                    <div class="form-outline">
                                                        <label class="form-label" for="form6Example1">Username</label>
                                                        <input type="text" id="form6Example1"
                                                            value="<%= userDetails.name  %>" name="firstName"
                                                            required class="form-control" />

                                                    </div>
                                                    <span id="firstNameError" class="error-message"></span>
                                                </div>
                                            </div>


                                            <!-- Email input -->
                                            <div class="form-outline mb-4">
                                                <label class="form-label" for="form6Example5">Email</label>
                                                <input type="email" id="form6Example5" value="<%= userDetails.email  %>"
                                                    name="email" required class="form-control" />
                                                <span id="emailError" class="error-message text-danger"></span>
                                            </div>



                                            <div class="form-outline ">
                                                <label class="form-label" for="form6Example9">Gender</label>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender" id="male"
                                                        value="male" checked />
                                                    <label class="form-check-label" for="male">Male</label>
                                                </div>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender"
                                                        id="female" value="female"
                                                        <%= userDetails.gender === "female" ? "checked" : "" %> />
                                                    <label class="form-check-label" for="female">Female</label>
                                                </div>

                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="gender"
                                                        id="others" value="others"
                                                        <%= userDetails.gender === "others" ? "checked" : "" %> />
                                                    <label class="form-check-label" for="others">Others</label>
                                                </div>
                                            </div>



                                            <!-- Number input -->
                                            <div class="form-outline mb-4">
                                                <label class="form-label" for="form6Example6">Phone</label>
                                                <input type="number" id="form6Example6"
                                                    value="<%= userDetails.mobile  %>" name="mobile" required
                                                    class="form-control" />
                                                <span id="mobileError" class="error-message text-danger"></span>
                                            </div>



                                            <!-- Checkbox -->
                                            <!-- <div class="form-check d-flex justify-content-center mb-4">
                                              <input class="form-check-input me-2" type="checkbox" value="" id="form6Example8" checked />
                                              <label class="form-check-label" for="form6Example8"> Create an account? </label>
                                            </div> -->

                                            <!-- Submit button -->
                                            <!-- Button to open the first modal -->
                                            <!-- Button to open the user contact details modal -->
                                            <!-- Button to open the user contact details modal -->
                                            <button id="openModal" type="submit"
                                                class="btn btn-primary btn-block mb-4">Save Changes</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- //Modals -->

<!-- Example return modal element -->
<div class="modal fade" id="returnModal" tabindex="-1" aria-labelledby="returnModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="returnModalLabel">Enter Return Reason</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="closeModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="returnReason" class="form-label">Reason for Return:</label>
                <textarea class="form-control" id="returnReason" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitReturn()">Submit Return</button>
            <!-- Spinner -->
        <div class="spinner-border text-primary" role="status" id="submitReturnSpinner" style="display: none;">
            <span class="visually-hidden">Loading...</span>
        </div>
            </div>
        </div>
    </div>
</div>

 <!-- REFERRAL MODAL -->
        <!-- Modal -->
        <div class="modal fade" id="myModel" tabindex="-1" aria-labelledby="myModelLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="myModelLabel">Share Modal</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Share this link via</p>
                        <div class="d-flex align-items-center icons">
                            <a href="https://www.facebook.com/sharer/sharer.php?u=<%= generatedRefLink %>"
                                class="fs-5 d-flex align-items-center justify-content-center" target="_blank">
                                <span class="fab fa-facebook-f"></span>
                            </a>

                            <a href="https://twitter.com/intent/tweet?url=YOUR_URL&text=<%= generatedRefLink %>"
                                class="fs-5 d-flex align-items-center justify-content-center" target="_blank">
                                <span class="fab fa-twitter"></span>
                            </a>
                            <a href="https://www.instagram.com/share?url=<%= generatedRefLink %>"
                                class="fs-5 d-flex align-items-center justify-content-center" target="_blank">
                                <span class="fab fa-instagram"></span>
                            </a>
                            <a href="https://api.whatsapp.com/send?text=<%= generatedRefLink %>"
                                class="fs-5 d-flex align-items-center justify-content-center" target="_blank">
                                <span class="fab fa-whatsapp"></span>
                            </a>
                            <a href="https://t.me/share/url?url=<%= generatedRefLink %>"
                                class="fs-5 d-flex align-items-center justify-content-center" target="_blank">
                                <span class="fab fa-telegram-plane"></span>
                            </a>
                        </div>

                        <p>Or copy link</p>
                        <div class="field d-flex align-items-center justify-content-between">
                            <span class="fas fa-link text-center"></span>
                            <input type="text" value="<%= generatedRefLink %>">
                            <button>Copy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<!-- User Contact Details Modal -->
<div class="modal fade" id="userContactModal" tabindex="-1" aria-labelledby="userContactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userContactModalLabel">User Contact Details</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Email: <%= userDetails.email %></p>
                <!-- Button to request OTP -->
                <button id="requestOTPButton" class="btn btn-primary">Request OTP</button>
            </div>
        </div>
    </div>
</div>

<!-- OTP Verification Modal -->
<div class="modal fade" id="otpVerificationModal" tabindex="-1" aria-labelledby="otpVerificationModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="otpVerificationModalLabel">OTP Verification</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Enter the OTP received on your email:</p>
                <input type="text" id="otpInput" class="form-control">
                <button id="verifyOTPButton" class="btn btn-primary mt-3">Verify OTP</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/cropperjs@1.5.12/dist/cropper.min.js"></script>



<script src="/javascripts/USER/ORDERLISTING.js" type="text/javascript"></script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<script>

document.addEventListener('DOMContentLoaded', function (e) {
                let field = document.querySelector('.field');
                let input = document.querySelector('input');
                let copyBtn = document.querySelector('.field button');

                copyBtn.onclick = async () => {

                    try {
                        await navigator.permissions.query({ name: 'clipboard-write' });
                        await navigator.clipboard.writeText(input.value);

                        field.classList.add('active');
                        copyBtn.innerText = 'Copied';

                        setTimeout(() => {
                            field.classList.remove('active');
                            copyBtn.innerText = 'Copy';
                        }, 3500);
                    } catch (err) {
                        console.error('Unable to copy to clipboard', err);
                    }
                };
            });
$(document).ready(function () {
    // An array of Indian states
    var indianStates = [
        "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chhattisgarh", "Goa",
        "Gujarat", "Haryana", "Himachal Pradesh", "Jharkhand", "Karnataka", "Kerala", "Madhya Pradesh",
        "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Punjab", "Rajasthan",
        "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"
    ];

    // Populate the select box with the list of states
    $('#state').select2({
        data: indianStates.map(function (state) {
            return {
                id: state,
                text: state
            };
        }),
        placeholder: 'Select a state',
        allowClear: true
    });

    document.getElementById('saveAddress').addEventListener('click', function () {
        // Validate and save the address
        if (validateForm()) {
            saveAddress();
        }
    });

    function validateForm() {
        var valid = true;
        var addressType = $('#addressType').val();
        var houseNo = $('#houseNo').val();
        var street = $('#street').val();
        var pincode = $('#pincode').val();
        var city = $('#city').val();
        var district = $('#district').val();
        var state = $('#state').val();
        var country = $('#country').val();
        
        // Clear previous errors
        clearErrors();

        // Validation rules
        if (!addressType || addressType.trim() === '') {
            valid = false;
            $('#addressTypeError').text('Type of Address is required');
        }
        if (!houseNo || houseNo.trim() === '') {
            valid = false;
            $('#houseNoError').text('House No is required.');
        }
        if (!street || street.trim() === '' || !/^[A-Za-z\s]*$/.test(street)) {
            valid = false;
            $('#streetError').text('Street is required and should only contain text.');
        }
        if (!pincode || pincode.trim() === '' || pincode.length !== 6 || isNaN(pincode)) {
            valid = false;
            $('#pincodeError').text('Pincode must be a 6-digit number.');
        }
        if (!city || city.trim() === '' || !/^[A-Za-z\s]*$/.test(city)) {
            valid = false;
            $('#cityError').text('City is required and should only contain text.');
        }
        if (!district || district.trim() === '' || !/^[A-Za-z\s]*$/.test(district)) {
            valid = false;
            $('#districtError').text('District is required and should only contain text.');
        }
        if (!state || state.trim() === '') {
            valid = false;
            $('#stateError').text('State is required.');
        }
        if (!country || country.trim() === '' || !/^[A-Za-z\s]*$/.test(country)) {
            valid = false;
            $('#countryError').text('Country is required and should only contain text.');
        }

        return valid;
    }

    function clearErrors() {
        $('#addressTypeError').text('');
        $('#houseNoError').text('');
        $('#streetError').text('');
        $('#pincodeError').text('');
        $('#cityError').text('');
        $('#districtError').text('');
        $('#stateError').text('');
        $('#countryError').text('');
    }

    function saveAddress() {
        var addressData = {
            addressType: $('#addressType').val(),
            houseNo: $('#houseNo').val(),
            street: $('#street').val(),
            landmark: $('#landmark').val(),
            pincode: $('#pincode').val(),
            city: $('#city').val(),
            district: $('#district').val(),
            state: $('#state').val(),
            country: $('#country').val()
        };

        fetch('/profile/addAddress', {
            method: 'POST',
            body: JSON.stringify(addressData),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(function (response) {
            return response.json();
        })
        .then(function (data) {
            if (data.message) {
                Swal.fire('Success', 'Address Saved Successfully', 'success');
                $('#addressModal').modal('hide');
                window.location.reload();
            } else {
                alert('Failed to save address. Please try again.');
            }
        })
        .catch(function (error) {
            console.error(error);
        });
    }
});





    //Edit ADdress
    function addressRemove(addressType) {
        // You can use AJAX (e.g., fetch or XMLHttpRequest) to send a DELETE request to the backend
        Swal.fire({
        title: 'Are you sure?',
        text: 'You won\'t be able to revert this!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'No, cancel!',
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/profile/deleteAddress?addressType=${addressType}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then((response) => {
                if (response.ok) {
                    // Address was successfully deleted
                    // Display a success message
                    Swal.fire('Success', 'Address Deleted Successfully', 'success').then(() => {
                        // Reload the page after the user confirms the success message
                        window.location.reload();
                    });
                } else {
                    // Handle the error and display an error message
                    console.error('Error deleting address:', response.statusText);
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }
    });
    }





    //Edit Profile Details
    // Open the first modal when the button is clicked
    // Open the user contact details modal when the button is clicked
    // const openModalButton = document.getElementById('openModal');
    // const userContactModal = new bootstrap.Modal(document.getElementById('userContactModal'));
    // const otpVerificationModal = new bootstrap.Modal(document.getElementById('otpVerificationModal'));


    const form = document.querySelector('#editprofile');
const firstNameInput = document.getElementById('form6Example1');
const emailInput = document.getElementById('form6Example5');
const mobileInput = document.getElementById('form6Example6');

form.addEventListener('submit', (event) => {
    event.preventDefault();
    let isValid = true;

    // Reset previous error messages
    document.querySelectorAll('.error-message').forEach((error) => {
        error.textContent = '';
    });

    // Validate first name
    if (!/^[A-Za-z]+$/.test(firstNameInput.value.trim())) {
        document.getElementById('firstNameError').textContent = 'First name is required and should only contain letters.';
        isValid = false;
    }

    // Validate email format
    const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
    if (!emailPattern.test(emailInput.value)) {
        document.getElementById('emailError').textContent = 'Invalid email format.';
        isValid = false;
    }

    // Validate mobile number (10 digits, not all same)
    if (mobileInput.value.length !== 10) {
        document.getElementById('mobileError').textContent = 'Mobile number must be 10 digits.';
        isValid = false;
    } else if (/^(\d)\1{9}$/.test(mobileInput.value)) {
        document.getElementById('mobileError').textContent = 'Mobile number cannot consist of the same digit 10 times.';
        isValid = false;
    }

    if (isValid) {
        // Rest of your code to submit the form data remains the same
        const firstName = document.getElementById('form6Example1').value;
        const email = document.getElementById('form6Example5').value;
        const gender = document.querySelector('input[name="gender"]:checked').value;
        const mobile = document.getElementById('form6Example6').value;

        const formData = {
            firstName,
            email,
            gender,
            mobile
        }

        // Submit the form data using fetch
        fetch('/profile/editProfile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    // Handle success with Swal
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: 'Profile Updated successfully',
                    });
                } else {
                    // Handle errors with Swal
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: `Error: ${data.message}`,
                    });
                }
            })
            .catch((error) => {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: `Fetch error: ${error}`,
                });
            });
    }
});



    document.querySelector('#changePasswordbtn').addEventListener('click', () => {
        // Make a fetch request to the '/change password' route
        console.log("clicked")
        fetch('/profile/change-password', {
                method: 'GET', // You can adjust the HTTP method as needed
            })
            .then(response => {
        if (response.ok) {
            // Handle success with a success SweetAlert message
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: 'Password Reset link sent successfully',
            });
        } else {
            // Handle errors with an error SweetAlert message
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Error changing password',
            });
        }
    })

    });



    function cancelOrder(orderId) {
        // Open the confirmation modal
        const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
        confirmationModal.show();

        // Handle the "Confirm Cancellation" button click
        const confirmCancellationButton = document.getElementById('confirmCancellationButton');
        confirmCancellationButton.addEventListener('click', function () {
            const cancellationReason = document.getElementById('cancellationReason').value;
            // Send an AJAX request to the server to cancel the order with the reason
            fetch(`/cancel-order/${orderId}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        reason: cancellationReason
                    }),
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then((response) => response.json())
                .then((result) => {
                    if (result.success) {
                        // Handle success, e.g., display a success message or update the UI
                        Swal.fire('Success', 'Order has been canceled successfully', 'success');
                        location.reload(); // Reload the page or refresh the order list
                    } else {
                        // Handle the case when the cancellation fails
                        alert('Order cancellation failed. Please try again.');
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again later.');
                });

            // Close the modal
            confirmationModal.hide();
        });
    }

    //Wallet Section

function addMoneyToWallet(userId) {
    Swal.fire({
        title: 'ENTER THE AMOUNT TO ADD :',
        input: 'text',
        inputLabel: 'Amount',
        inputPlaceholder: 'Enter the amount',
        showCancelButton: true,
        confirmButtonText: 'Add Money',
        showLoaderOnConfirm: true,
        preConfirm: (amount) => {
            // Validate the entered amount (you can add more validation as needed)
            if (!amount || isNaN(parseFloat(amount)) || amount<0) {
                Swal.showValidationMessage('Please enter a valid amount');
                return false;
            }

            // Make a POST request to add money to the wallet
            return fetch('/create-razorpay-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId, amount }),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error adding money to wallet');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Initialize Razorpay
                    const options = {
                        key: data.key_id,
                        amount: data.amount * 100, // Amount in paise
                        currency: data.currency,
                        name: data.name,
                        description: 'Add Money to Wallet',
                        order_id: data.orderId,
                        handler: function (response) {
                            // Handle the payment success
                            Swal.fire('Success', 'Payment successful!', 'success');
                            // Send the payment confirmation to your server
                            confirmPayment(userId, amount, response.razorpay_payment_id);
                        },
                        prefill: {
                            email: data.email,
                            contact: data.contact,
                        },
                        theme: {
                            color: '#007BFF',
                        },
                    };
    
                    const rzp = new Razorpay(options);
                    rzp.open();
                } else {
                    Swal.fire('Error', 'Failed to create Razorpay order', 'error');
                }
            })
            .catch(error => {
                Swal.showValidationMessage(`Request failed: ${error}`);
            });
        },
        allowOutsideClick: () => !Swal.isLoading(),
    })
    .then((result) => {
        if (result.isConfirmed) {
            Swal.fire('Success', `Money added successfully. New balance: $${result.value.balance.toFixed(2)}`, 'success');
        }
    });
}

function confirmPayment(userId, amount, paymentId) {
    // Send a request to your server to confirm the payment and update the wallet
    fetch('/confirm-payment', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId, amount, paymentId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Handle the success response if needed
        } else {
            Swal.fire('Error', 'Failed to confirm payment', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        Swal.fire('Error', 'Something went wrong', 'error');
    });
}

function showWithdrawalPrompt(balance) {
    Swal.fire({
      title: 'Enter withdrawal amount',
      input: 'text',
      inputAttributes: {
        autocapitalize: 'off',
      },
      showCancelButton: true,
      confirmButtonText: 'Withdraw',
      showLoaderOnConfirm: true,
      preConfirm: (amount) => {
         // Client-side validation
      if (parseFloat(amount) < 1 || isNaN(parseFloat(amount))) {
        Swal.showValidationMessage('Invalid withdrawal amount. Amount must be at least 1.');
        return false;
      } else if (parseFloat(amount) > balance) {
        Swal.showValidationMessage(`You don't have enough balance`);
        return false;
      }
      
        // You can perform client-side validation here if needed
        return fetch('/withdraw', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ amount }),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(response.statusText);
            }
            return response.json();
          })
          .catch((error) => {
            Swal.showValidationMessage(`Request failed: ${error}`);
          });
      },
      allowOutsideClick: () => !Swal.isLoading(),
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          title: 'Withdrawal successful!',
          icon: 'success',
        });
      }
    });
  }

</script>

<%- include('userSidePartials/UserFooter') %>