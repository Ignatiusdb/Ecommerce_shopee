<!DOCTYPE HTML>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Product List</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/stylesheets/assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link href="/stylesheets/assets/css/main.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <div class="screen-overlay"></div>

    <div class="page-wrapper">
        <aside class="navbar-aside" id="offcanvas_aside">
            <div class="aside-top">
                <a href="admin/dashboard" class="brand-wrap">
                    <img src="\stylesheets\assets\imgs\brands\brand-20.jpg" class="logo" alt="Evara Dashboard">
                </a>
                <div>
                    <button class="btn btn-icon btn-aside-minimize"> <i
                            class="text-muted material-icons md-menu_open"></i> </button>
                </div>
            </div>
            <nav>
                <ul class="menu-aside">

                    <a class="menu-link" href="admin/dashboard"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                    </li>
                    <li class="menu-item has-submenu">
                    <li class="menu-item active"></li>
                    <a class="menu-link" href="page-products-list.ejs"> <i
                            class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                    <div class="submenu">

                        <a href="/admin/product-management">Product List</a>
                        <!-- <a href="page-products-grid.ejs">Product grid</a>
                            <a href="page-products-grid-2.ejs">Product grid 2</a> -->
                        <a href="/admin/category-management">Categories</a>
                    </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-orders-1.html"> <i
                                class="icon material-icons md-shopping_cart"></i>
                            <span class="text">Orders</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/order-management">Orders </a>
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-orders-1.html"> <i class="icon material-icons md-stars"></i>
                            <span class="text">Banner</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/banner-management">Banner Management </a>
                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-sellers-cards.html"> <i
                                class="icon material-icons md-store"></i>
                            <span class="text">Users</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/users">Users list</a>

                        </div>
                    </li>
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-sellers-cards.html"> <i
                                class="icon material-icons md-person"></i>
                            <span class="text">Coupons</span>
                        </a>
                        <div class="submenu">
                            <a href="/admin/coupon-management">Coupon</a>

                        </div>
                    </li>

                    <!-- <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-form-product-1.ejs"> <i class="icon material-icons md-add_box"></i>
                            <span class="text">Add product</span>
                        </a>
                        
                        <div class="submenu">
                            <a href="page-form-product-1.ejs">Add product 1</a>
                            <a href="/admin/addProduct">Add product</a>
                            <a href="page-form-product-3.ejs">Add product 3</a>
                            <a href="page-form-product-4.ejs">Add product 4</a>
                        </div>
                    </li> -->
                    <!-- <li class="menu-item has-submenu">
                        <a class="menu-link" href="page-transactions-1.html"> <i class="icon material-icons md-monetization_on"></i>
                            <span class="text">Transactions</span>
                        </a>
                        <div class="submenu">
                            <a href="page-transactions-1.html">Transaction 1</a>
                            <a href="page-transactions-2.html">Transaction 2</a>
                            <a href="page-transactions-details.html">Transaction Details</a>
                        </div>
                    </li> -->
                    <!-- <li class="menu-item has-submenu">
                        <a class="menu-link" href="#"> <i class="icon material-icons md-person"></i>
                            <span class="text">Account</span>
                        </a>
                        <div class="submenu">
                            <a href="page-account-login.html">User login</a>
                            <a href="page-account-register.html">User registration</a>
                            <a href="page-error-404.ejs">Error 404</a>
                        </div>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="page-reviews.html"> <i class="icon material-icons md-comment"></i>
                            <span class="text">Reviews</span>
                        </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="page-brands.html"> <i class="icon material-icons md-stars"></i>
                            <span class="text">Brands</span> </a>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" disabled href="#"> <i class="icon material-icons md-pie_chart"></i>
                            <span class="text">Statistics</span>
                        </a>
                    </li> -->
                </ul>
                <hr>
                <ul class="menu-aside">
                    <li class="menu-item has-submenu">
                        <a class="menu-link" href="#"> <i class="icon material-icons md-settings"></i>
                            <span class="text">Settings</span>
                        </a>
                        <div class="submenu">
                            <a href="page-settings-1.html">Setting sample 1</a>
                            <a href="page-settings-2.html">Setting sample 2</a>
                        </div>
                    </li>
                    <li class="menu-item">
                        <a class="menu-link" href="page-blank.html"> <i class="icon material-icons md-local_offer"></i>
                            <span class="text"> Starter page </span>
                        </a>
                    </li>
                </ul>
                <br>
                <br>
            </nav>
        </aside>
        <div class="main-container">
            <main class="main-wrap">
                <header class="main-header navbar">
                    <div class="col-search">
                        <!-- <form class="searchform">
                            <div class="input-group">
                                <input list="search_terms" type="text" class="form-control" placeholder="Search term">
                                <button class="btn btn-light bg" type="button"> <i
                                        class="material-icons md-search"></i></button>
                            </div>
                            <datalist id="search_terms">
                                <option value="Products">
                                <option value="New orders">
                                <option value="Apple iphone">
                                <option value="Ahmed Hassan">
                            </datalist>
                        </form> -->
                    </div>
                    <div class="col-nav">
                        <!-- <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"> <i
                                class="material-icons md-apps"></i> </button>
                        <ul class="nav">
                            <li class="nav-item">
                                <a class="nav-link btn-icon" href="#">
                                    <i class="material-icons md-notifications animation-shake"></i>
                                    <span class="badge rounded-pill">3</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link btn-icon darkmode" href="#"> <i
                                        class="material-icons md-nights_stay"></i> </a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="requestfullscreen nav-link btn-icon"><i
                                        class="material-icons md-cast"></i></a>
                            </li> -->
                        <!-- <li class="dropdown nav-item">
                                <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage"
                                    aria-expanded="false"><i class="material-icons md-public"></i></a>
                                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                                    <a class="dropdown-item text-brand" href="#"><img src="/imgs/theme/flag-us.png"
                                            alt="English">English</a>
                                    <a class="dropdown-item" href="#"><img src="/stylesheets/imgs/theme/flag-fr.png"
                                            alt="Français">Français</a>
                                    <a class="dropdown-item" href="#"><img src="/stylesheets/imgs/theme/flag-jp.png"
                                            alt="Français">日本語</a>
                                    <a class="dropdown-item" href="#"><img src="/stylesheets/imgs/theme/flag-cn.png"
                                            alt="Français">中国人</a>
                                </div>
                            </li> -->
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                                aria-expanded="false"> <img class="img-xs rounded-circle"
                                    src="/stylesheets/assets/imgs/people/avatar2.jpg" alt="User"></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                <!-- <a class="dropdown-item" href="#"><i
                                            class="material-icons md-perm_identity"></i>Edit Profile</a>
                                    <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                        Settings</a>
                                    <a class="dropdown-item" href="#"><i
                                            class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                    <a class="dropdown-item" href="#"><i
                                            class="material-icons md-receipt"></i>Billing</a>
                                    <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                        center</a> -->
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger" href="/admin/logout"><i
                                        class="material-icons md-exit_to_app"></i>Logout</a>
                            </div>
                        </li>
                        </ul>
                    </div>
                </header>
                <div
                    class="d-flex ms-4 me-4 justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h3 class="h3 text-primary">Product Management</h3>
                    <div class="btn-toolbar mb-2 mb-md-0">

                        <!-- <!- Dropdown to select a category for sorting 
                         <select id="categoryFilter" class="form-select"> 
                         <select class="form-control form-select" id="productCategory" name="category" required>
                                    <option value="">Select a category</option>
                                  </select> 

                        <div class="btn-group me-2">
                            <form action="product-management" method="GET">

                                <select class="form-control" name="category">
                                    <option value="">All Categories <i class="fa-solid fa-caret-down"
                                            style="color: #000000;"></i></option>
                                    <% categories.forEach(category=> { %>
                                        <option value="<%= category._id %>"
                                            <%=category._id.toString()===selectedCategory ? 'selected' : '' %>>
                                            <%= category.name %>
                                        </option>
                                        <% }) %>
                                </select>

                        </div>
                        <div class="btn-group me-2">
                            <button type="submit" class="btn  btn-sm  btn-outline-primary mb-2">Filter</button>
                            </form>
                        </div> -->



                        <div class="btn-group mb-2 me-2">
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                data-bs-target="#createProductModal">
                                + Add Product
                            </button>
                        </div>
                    </div>
                </div>

                <div class="content-wrapper">

                    <!-- Content wrapper start -->
                    <div class="content-wrapper">
                        <!-- Modal for adding new products -->
                        <div id="successMessage" class="alert alert-success" style="display: none;"></div>
                        <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>


                        <div class="container mt-2">
                            <% products.forEach((item)=>{ %>
                                <div class="d-flex justify-content-center row mt-2">
                                    <div class="col-md-10">
                                        <div class="row p-2 bg-white border rounded">
                                            <div class="col-md-3 mt-1">

                                                <img class="img-fluid img-responsive rounded product-image"
                                                    src="/<%= item.image %>" alt="<%= item.name %> Image">
                                                <!-- "data:image/webp;base64 -->
                                            </div>
                                            <div class="col-md-6 mt-1">
                                                <h5>
                                                    <%= item.name %>
                                                </h5>
                                                <div class="d-flex flex-row">

                                                    <div class="ratings mr-2 me-1">
                                                        <% for (let i=1; i <=5; i++) { %>
                                                            <% if(i<=item.rating){ %>
                                                                <i class="fa fa-star" style="color: yellow;"></i>
                                                                <% }else{ %>
                                                                    <i class="fa fa-star"
                                                                        style="color: black; border-color: black;"></i>
                                                                    <% } } %>
                                                    </div> <span>
                                                        <%= //item.rating %>
                                                    </span>
                                                </div>

                                                <div class="mt-1 mb-1 spec-1">
                                                    <span>
                                                        <%= item.brand %>
                                                    </span>
                                                    <span class="dot"></span>
                                                    <span>|| Stocks:
                                                        <span
                                                            class="<%= item.countInStock === 0 ? 'text-danger' : '' %>">
                                                            <%= item.countInStock %>
                                                                <%= item.countInStock===0 ? ' (Out of Stock)' : '' %>
                                                        </span>
                                                    </span>
                                                    <span class="dot"></span>
                                                    <span
                                                        class="badge <%= item.isFeatured ? 'bg-success' : 'bg-danger' %>">
                                                        <%= item.isFeatured ? 'Published' : 'Not Published' %>
                                                    </span>
                                                </div>


                                                <!-- <div class="mt-1 mb-1 spec-1"><span>
                                                        <%= //item.description %>
                                                    </span></div>
                                                 <p class="text-justify text-truncate para mb-0">Category : <%=// item.category.name%><br><br></p>
                                                <p class="text-justify text-truncate para mb-0">Description :<%=//item.description %>
                                                </p>
                                            </div> -->
                                                <!-- <div class="mt-1 mb-1 spec-1">
                                                    <span>
                                                        <%= //item.description %>
                                                    </span>
                                                </div> -->
                                                <p class="text-justify text-truncate para mb-0">
                                                    <% if (item.category && item.category.name) { %>
                                                        Category : <%= item.category.name %><br><br>
                                                            <% } %>
                                                                Description : <%= item.description %>
                                                </p>


                                                <div
                                                    class="align-items-center align-content-center col-md-3 border-left mt-1">
                                                    <div class="d-flex flex-row align-items-center">
                                                        <span></span>
                                                        <h4 class="mr-1">₹ <%= item.basePrice %>
                                                        </h4>
                                                    </div>
                                                    <div class="d-flex flex-row align-items-center">
                                                        <span>Discount :</span>
                                                        <h4 class="mr-1">
                                                            <%= item.discount %>%
                                                        </h4>
                                                    </div>
                                                    <div class="d-flex flex-row align-items-center">
                                                        <h4 class="mr-1">₹ <%= item.price %>
                                                        </h4>
                                                    </div>
                                                    <!-- <button data-product-id="<%= //item._id %>"
                                                    data-is-featured="<%=// item.isFeatured %>" class="btn btn-sm publish-button
                                                    <%=// item.isFeatured ? 'btn-success' : 'btn-dark' %>">
                                                    <%=// item.isFeatured ? 'Unpublish' : 'Publish' %>
                                                </button> -->
                                                    <button data-product-id="<%= item._id %>"
                                                        data-is-featured="<%= item.isFeatured %>"
                                                        class="btn btn-sm publish-button
                                                    <%= (item.category && !item.category.isDeleted) ? (item.isFeatured ? 'btn-success' : 'btn-dark') : 'btn-dark' %>"
                                                        data-toggle="modal" data-target="#publishModal">
                                                        <%=(item.isFeatured ? 'Unlist' : 'list' ) %>
                                                    </button>






                                                    <div class="d-flex flex-column mt-4">


                                                        <button class="btn btn-warning btn-sm" data-bs-toggle="modal"
                                                            data-bs-target="#editModal<%= item._id %>" type="button"
                                                            data-category-id="<%= item._id %>">Edit product</button>


                                                        <!-- Modal for editing product details -->
                                                        <div class="modal fade" id="editModal<%= item._id %>"
                                                            tabindex="-1" role="dialog"
                                                            aria-labelledby="editProductModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog" role="document">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title"
                                                                            id="editProductModalLabel">
                                                                            Edit Product Details</h5>
                                                                        <button type="button" class="close"
                                                                            data-bs-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <!-- Form for editing product details -->
                                                                        <form
                                                                            action="product-management/editProduct/<%= item._id %>"
                                                                            enctype="multipart/form-data"
                                                                            id="EditProductForm" method="post">
                                                                            <!-- You can include the product ID as a hidden input -->
                                                                            <div class="form-group  mb-3">
                                                                                <label for="editProductName">Product
                                                                                    Name</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="editProductName" name="name"
                                                                                    value="<%= item.name %>" required>
                                                                            </div>
                                                                            <div class="form-group  mb-3">
                                                                                <label
                                                                                    for="editProductDescription">Description</label>
                                                                                <textarea class="form-control"
                                                                                    id="editProductDescription"
                                                                                    name="description"
                                                                                    required><%= item.description %></textarea>
                                                                            </div>

                                                                            <div class="form-group mb-3">
                                                                                <label for="editMainImage">Main Image
                                                                                    (Upload one file)</label>
                                                                                <input type="file"
                                                                                    class="form-control-file"
                                                                                    id="editMainImage" name="image"
                                                                                    accept="image/*">
                                                                                <div class="mt-2">
                                                                                    <!-- Display the current main image if it exists -->
                                                                                    <% if (item.image) { %>
                                                                                        <img src="/<%= item.image %>"
                                                                                            alt="<%= item.name %> Image"
                                                                                            style="max-width: 100%; height: 50px;">
                                                                                        <% } else { %>
                                                                                            <!-- Show a placeholder image or message if no current image exists -->
                                                                                            <img src="/placeholder-image.png"
                                                                                                alt="No Image"
                                                                                                style="max-width: 100%; height: auto;">
                                                                                            <% } %>
                                                                                </div>
                                                                            </div>


                                                                            <div class="form-group mb-3">
                                                                                <label
                                                                                    for="editAdditionalImages">Additional
                                                                                    Images (Upload multiple
                                                                                    files)</label>
                                                                                <input type="file"
                                                                                    class="form-control-file"
                                                                                    id="editAdditionalImages"
                                                                                    name="images" accept="image/*"
                                                                                    multiple>

                                                                                <div class="mt-2">
                                                                                    <!-- Display the current additional images if they exist -->
                                                                                    <% if (item.images &&
                                                                                        item.images.length> 0) { %>
                                                                                        <div class="row">
                                                                                            <%
                                                                                                item.images.forEach(image=>
                                                                                                {
                                                                                                %>
                                                                                                <div class="col-md-3">
                                                                                                    <img src="/<%= image %>"
                                                                                                        alt="Additional Image"
                                                                                                        style="max-width: 100%; height: 50px;">
                                                                                                </div>
                                                                                                <% }); %>
                                                                                        </div>
                                                                                        <% } else { %>
                                                                                            <!-- Show a message if no current additional images exist -->
                                                                                            <p>No additional images
                                                                                                available.</p>
                                                                                            <% } %>
                                                                                </div>
                                                                            </div>

                                                                            <div class="form-group  mb-3">
                                                                                <label
                                                                                    for="editProductBrand">Brand</label>
                                                                                <input type="text" class="form-control"
                                                                                    id="editProductBrand" name="brand"
                                                                                    value="<%= item.brand %>">
                                                                            </div>
                                                                            <div class="form-group  mb-3">
                                                                                <label
                                                                                    for="editProductCountInStock">Count
                                                                                    in Stock</label>
                                                                                <input type="number"
                                                                                    class="form-control"
                                                                                    id="editProductCountInStock"
                                                                                    name="countInStock"
                                                                                    value="<%= item.countInStock %>"
                                                                                    required>
                                                                            </div>
                                                                            <div class="form-group mb-3">
                                                                                <label
                                                                                    for="editProductCategory">Category</label>
                                                                                <select class="form-control"
                                                                                    id="editProductCategory"
                                                                                    name="category" required>
                                                                                    <option value="">Select a category
                                                                                    </option>
                                                                                    <% categories.forEach(category=> {
                                                                                        %>
                                                                                        <option
                                                                                            value="<%= category._id %>"
                                                                                            <%=item.category &&
                                                                                            category._id.toString()===item.category._id.toString()
                                                                                            ? 'selected' : '' %>>
                                                                                            <%= category.name %>
                                                                                        </option>
                                                                                        <% }) %>
                                                                                </select>
                                                                            </div>
                                                                    </div>
                                                                    <div class="form-group  mb-3">
                                                                        <label for="editProductPrice">Price</label>
                                                                        <input type="number" class="form-control"
                                                                            id="editProductPrice" name="price"
                                                                            value="<%= item.basePrice %>" required>
                                                                    </div>
                                                                    <div class="form-group  mb-3">
                                                                        <label for="editProductPrice">Discount</label>
                                                                        <input type="number" class="form-control"
                                                                            id="editProductDiscount" name="discount"
                                                                            value="<%= item.discount %>" required>
                                                                    </div>
                                                                    <button type="submit" class="btn btn-primary">Save
                                                                        Changes</button>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>



                                                    <button class="btn  btn-danger btn-sm mt-2" type="button"
                                                        onclick="deleteProduct('<%= item._id %>')"
                                                        aria-labelledby="exampleModalLabel" data-bs-toggle="modal"
                                                        data-bs-target="#confirmationModal">
                                                        Delete product</button>
                                                </div>
                                            </div>
                                        </div>



                                    </div>

                                </div>
                                <% }) %>
                                    <br></br>
                        </div>

                    </div>

                </div>
        </div>
    </div>
    </div>

    // !-- form for adding new product-->
    <div class="modal fade" id="createProductModal" tabindex="-1" role="dialog"
        aria-labelledby="createProductModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createProductModalLabel">Add New Product</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <form method="POST" id="addNewProduct" action="product-management/newProduct"
                        enctype="multipart/form-data">
                        <div class="form-group mb-3">
                            <label for="productName">Product Name</label>
                            <input type="text" class="form-control" id="productName" name="name" required>
                            <span id="productNameError" class="error-message"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label for="productDescription">Description</label>
                            <textarea class="form-control" id="productDescription" name="description"
                                required></textarea>
                                <span id="productDescription" class="error-message"></span>
                        </div>

                        Main image

                        <div class="form-group mb-3">
                            <label for="mainImage">Main Image (Upload one file)</label>
                            <input type="file" class="form-control-file" id="image" name="image" accept="image/*"
                                onchange="initCropper('image')">
                            <img src="" id="showimage"
                                style="width: auto; height: 300px; margin-top: 10px; display: block;" alt="">
                            <button class="btn btn-warning p-2 px-5" id="updateimage"
                                onclick="uploadCroppedImage('image')" style="display: none;">Update</button>
                        </div>


                        <div class="form-group mb-3">
                            <label for="additionalImages">Additional Image 1</label>
                            <input type="file" class="form-control-file" id="image1" name="images" accept="image/*"
                                onchange="initCropper('image1')">
                            <img src="" id="showimage1"
                                style="width: auto; height: 300px; margin-top: 10px; display: block;" alt="">
                            <button class="btn btn-warning p-2 px-5" id="updateimage1"
                                onclick="uploadCroppedImage('image1')" style="display: none;">Update</button>
                        </div>


                        <div class="form-group mb-3">
                            <label for="productBrand">Brand</label>
                            <input type="text" class="form-control" id="productBrand" name="brand">
                            <span id="productBrand" class="error-message"></span>
                        </div>
                        <div class="form-group mb-3">
                            <label for="productCountInStock">Count in Stock</label>
                            <input type="number" class="form-control" id="productCountInStock" name="countInStock"
                                required>
                                <span id="productCountInStock" class="error-message"></span>   
                        </div>
                        <div class="form-group mb-3">
                            <label for="productCategory">Category</label>
                            <select class="form-control" id="productCategory" name="category" required>
                                <option value="">Select a category</option>

                                <% categories.forEach(category=> { %>
                                    <option value="<%= category._id %>">
                                        <%= category.name %>
                                    </option>
                                    <% }) %>

                            </select>
                            <span id="productCategory" class="error-message"></span> 
                        </div>
                        <div class="form-group mb-3">
                            <label for="productPrice">Price</label>
                            <input type="number" class="form-control" id="productPrice" name="price" required>
                            <span id="productPrice" class="error-message"></span> 
                        </div>
                        <div class="form-group mb-3">
                            <label for="productPrice">Discount</label>
                            <input type="number" class="form-control" id="discount%" name="discount" required>
                            <span id="discount" class="error-message"></span> 
                        </div>
                        <button type="submit" class="btn btn-primary">Add Product</button>
                    </form>

                </div>
            </div>
        </div>
    </div>




    <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <p class="text-center">Are you sure you want to delete this user?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cancelDelete()">No</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">Yes</button>
                </div>
            </div>
        </div>
    </div>



    <script>


        let cropper;

        function initCropper(id) {
            const input = document.getElementById(id);
            const canvas = document.getElementById(`show${id}`);
            const file = input.files[0];

            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    canvas.src = e.target.result;
                    document.getElementById(`update${id}`).style.display = 'block';
                    if (cropper) {
                        cropper.destroy();
                    }

                    cropper = new Cropper(canvas, {
                        viewMode: 2,
                    });
                };

                reader.readAsDataURL(file);
            } else {
                canvas.src = '';
                if (cropper) {
                    cropper.destroy();
                }
            }
        }

        function uploadCroppedImage(id) {
            const canvas = cropper.getCroppedCanvas();
            if (canvas) {
                canvas.toBlob((blob) => {
                    const fileName = 'cropped_image.jpg';
                    const file = new File([blob], fileName, { type: 'image/jpeg' });
                    const input = document.getElementById(id);

                    if (DataTransfer && FileList) {
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        input.files = dataTransfer.files;
                    } else {
                        console.error('FileList and DataTransfer are not supported in this browser.');
                    }

                    const showImg = document.getElementById(`show${id}`);
                    showImg.src = URL.createObjectURL(blob);

                    cropper.destroy();
                    document.getElementById(`update${id}`).style.display = 'none';
                });
            }
        }



        const confirmationModal = document.getElementById('confirmationModal');
        // confirmationModal.style.display = 'block'; 
        function deleteProduct(productId) {
            // Show the custom confirmation modal
            $('#confirmationModal').show('modal')

            // Store the productId in a data attribute for later use
            confirmationModal.dataset.productId = productId;
        }

        function confirmDelete() {
            const productId = confirmationModal.dataset.productId;

            // Close the custom confirmation modal
            confirmationModal.style.display = 'none';

            // Send a DELETE request to delete the product
            fetch('product-management/delete-product/' + productId, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        // Product was successfully deleted
                        // Reload the page to update the list of products
                        alert('Successfully deleted');
                        window.location.reload();
                    } else {
                        // Handle error
                        alert('An error occurred while deleting the product.');
                    }
                });
        }

        function cancelDelete() {
            confirmationModal.style.display = 'none';
            window.location.reload();
        }



        $(document).ready(function () {
            // Fetch categories from the backend API
            $.ajax({
                url: 'product-management/getCategories', // Adjust the URL as needed
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Iterate over the categories and add options to the select boxes
                    data.forEach(function (category) {
                        $('.product-category-select').each(function () {
                            const productId = $(this).data('product-id');
                            if ($(this).attr('id') === `productCategory${productId}`) {
                                $(this).append($('<option>', {
                                    value: category._id,
                                    text: category.name
                                }));
                            }
                        });
                    });
                },
                error: function (error) {
                    console.error(error);
                    //This is For Edit Product

                }
            });
        });


        $(document).ready(function () {
            // Fetch categories from the backend API
            $.ajax({
                url: 'product-management/getCategories', // Adjust the URL as needed
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // Iterate over the categories and add options to the select box
                    data.forEach(function (category) {
                        $('#productCategory').append($('<option>', {
                            value: category._id,
                            text: category.name
                        }));
                    });
                },
                error: function (error) {
                    console.error(error);
                    // this is for add new product
                    // Handle the error appropriately (e.g., display an error message)

                }
            });
        });

        // Handle form submission (adding new product)

        $(document).ready(function () {
            $("#productForm").submit(function (event) {
                event.preventDefault(); // Prevent the default form submission

                // Serialize the form data into a JSON object
                var formData = new FormData(this);

                // Send an AJAX POST request to the server
                $.ajax({
                    type: "POST",
                    url: "product-management/newProduct", // Adjust the URL as needed
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {

                        // Handle success response from the server (e.g., display a success message)
                        $("#successMessage").text("Product added successfully").show();
                        $("#errorMessage").hide();
                        console.log("Product added successfully");
                        // You can redirect or perform other actions here
                    },
                    error: function (error) {
                        // Handle error response from the server (e.g., display an error message)
                        console.error("Error adding product: " + error.responseText);
                        $("#errorMessage").text("Error adding product: " + error.responseText).show();
                        $("#successMessage").hide();
                    }
                });
            });
        });


        // Handle form submission (editing product)

        $(document).ready(function () {
            $(".edit-product-form").submit(function (event) {
                event.preventDefault(); // Prevent the default form submission

                // Serialize the form data into a JSON object
                var formData = new FormData(this);

                // Send an AJAX POST request to the server
                $.ajax({
                    type: "POST",
                    url: "product-management/editProduct/" + $(this).data("product-id"), // Use data-product-id to specify the product ID
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        // Handle success response from the server
                        $("#successMessage").text("Product updated successfully").show();
                        $("#errorMessage").hide();
                        console.log("Product updated successfully");
                        // You can redirect or perform other actions here
                    },
                    error: function (error) {
                        // Handle error response from the server
                        $("#errorMessage").text("Error updating product: " + error.responseText).show();
                        $("#successMessage").hide();
                        console.error("Error updating product: " + error.responseText);
                    }
                });
            });
        });


        // Function to handle the Publish button click event

        function handlePublishButtonClick(productId, isFeatured) {
            const newIsFeatured = !isFeatured; // Toggle the isFeatured value
            const requestData = {
                isFeatured: newIsFeatured
            };
            alert("Done")
            // Maalke an AJAX request to update the isFeatured status
            $.ajax({
                url: `product-management/updateProduct/${productId}`, // Adjust the URL as needed
                method: 'PUT',
                data: requestData,
                success: function (response) {
                    // Update the button text
                    const buttonText = newIsFeatured ? 'Unpublish' : 'Publish';
                    $(`button[data-product-id="${productId}"]`).text(buttonText);

                    // Update the data-is-featured attribute
                    $(`button[data-product-id="${productId}"]`).data('is-featured', newIsFeatured);

                    // Handle any other UI updates or notifications
                    window.location.reload();
                },
                error: function (error) {
                    // Handle error
                    console.error(error);
                    // Display an error message or take appropriate action
                    // ...
                }
            });
        }

        // Attach a click event listener to the Publish buttons

        $('.publish-button').click(function () {
            const productId = $(this).data('product-id');
            const isFeatured = $(this).data('is-featured');
            handlePublishButtonClick(productId, isFeatured);
        });

        // VALIDATIONS


        document.addEventListener("DOMContentLoaded", function () {
            const addForm = document.getElementById("addNewProduct");

            addForm.addEventListener("submit", function (event) {
                event.preventDefault();
                let valid = true;

                // Validation for Product Name
                const productName = document.getElementById("productName").value.trim();
                const productNameError = document.getElementById("productNameError");

                if (productName === "") {
                    valid = false;
                    alert("Please enter a Product Name");
                }else {
            productNameError.textContent = ""; // Clear error message if valid
        }

                // Validation for Description
                const productDescription = document.getElementById("productDescription").value.trim();
                const productDescriptionError = document.getElementById("productDescriptionError");
                if (productDescription === "") {
                    valid = false;
                    alert("Please enter a Description");
                }else {
                    productDescriptionError.textContent = ""; // Clear error message if valid
                }

                // Validation for Main Image
                const mainImageInput = document.getElementById("image");
                const mainImageFile = mainImageInput.files[0];
                if (!mainImageFile) {
                    valid = false;
                    alert("Please upload a Main Image");
                } else if (!mainImageFile.type.startsWith("image/")) {
                    valid = false;
                    alert("Main Image must be in image format");
                }

                // Validation for Additional Images
                const additionalImagesInput = document.getElementById("images");
                const additionalImagesFiles = additionalImagesInput.files;
                for (let i = 0; i < additionalImagesFiles.length; i++) {
                    const file = additionalImagesFiles[i];
                    if (!file.type.startsWith("image/")) {
                        valid = false;
                        alert("Additional Images must be in image format");
                        break;
                    }
                }

                const Brand = document.getElementById("productBrand").value.trim();
                const BrandError = document.getElementById("productBrandError");
                if (Brand === "" || isNaN(countInStock)) {
                    valid = false;
                    alert("Please enter a valid Count in Stock");
                }else {
                    BrandError.textContent = ""; // Clear error message if valid
                }

                const Category = document.getElementById("productCategory").value.trim();
                const CategoryError = document.getElementById("productCategoryError");
                if (Category === "" || isNaN(countInStock)) {
                    valid = false;
                    alert("Please enter a valid Count in Stock");
                }else {
                    CategoryError.textContent = ""; // Clear error message if valid
                }

                // Validation for Count in Stock
                const countInStock = document.getElementById("productCountInStock").value.trim();
                const countInStockError = document.getElementById("productCountInStockError");
                if (countInStock === "" || isNaN(countInStock)) {
                    valid = false;
                    alert("Please enter a valid Count in Stock");
                }else {
                    countInStockError.textContent = ""; // Clear error message if valid
                }

                // Validation for Price
                const price = document.getElementById("productPrice").value.trim();
                const priceError = document.getElementById("productPriceError");
                if (price === "" || isNaN(price) || parseFloat(price) < 0) {
                    valid = false;
                    alert("Please enter a valid Price greater than or equal to 0");
                }else {
                    priceError.textContent = ""; // Clear error message if valid
                }

                // Validation for Discount
                const discount = document.getElementById("discount%").value.trim();
                const discountError = document.getElementById("discount%Error");
                if (discount === "" || isNaN(discount) || parseFloat(discount) <= 0) {
                    valid = false;
                    alert("Please enter a valid Discount greater than 0");
                }else {
                    discountError.textContent = ""; // Clear error message if valid
                }

                // Prevent form submission if validation fails
                if (valid) {
                    this.submit()
                }
            });
        });





        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("EditProductForm");

            form.addEventListener("submit", function (event) {
                event.preventDefault();
                let valid = true;

                // Validation for Product Name
                const productName = document.getElementById("editProductName").value.trim();
                if (productName === "") {
                    valid = false;
                    alert("Please enter a Product Name");
                }

                // Validation for Description
                const productDescription = document.getElementById("editProductDescription").value.trim();
                if (productDescription === "") {
                    valid = false;
                    alert("Please enter a Description");
                }

                // Validation for Main Image
                const mainImageInput = document.getElementById("editMainImage");
                const mainImageFile = mainImageInput.files[0];
                if (mainImageFile) {
                    if (!mainImageFile.type.startsWith("image/")) {
                        valid = false;
                        alert("Main Image must be in image format");
                    }
                }

                // Validation for Additional Images
                const additionalImagesInput = document.getElementById("editAdditionalImages");
                const additionalImagesFiles = additionalImagesInput.files;
                for (let i = 0; i < additionalImagesFiles.length; i++) {
                    const file = additionalImagesFiles[i];
                    if (!file.type.startsWith("image/")) {
                        valid = false;
                        alert("Additional Images must be in image format");
                        break;
                    }
                }

                // Validation for Count in Stock
                const countInStock = document.getElementById("editProductCountInStock").value.trim();
                if (countInStock === "" || isNaN(countInStock)) {
                    valid = false;
                    alert("Please enter a valid Count in Stock");
                }

                // Validation for Price
                const price = document.getElementById("editProductPrice").value.trim();
                if (price === "" || isNaN(price) || parseFloat(price) < 0) {
                    valid = false;
                    alert("Please enter a valid Price greater than or equal to 0");
                }

                const discount = document.getElementById("editProductDiscount").value.trim();
                if (price === "" || isNaN(price) || parseFloat(price) <= 0) {
                    valid = false;
                    alert("Please enter a valid Price greater than 0");
                }

                // You can add more validations for other fields as needed

                if (valid) {
                    this.submit()
                }
            });
        });



    </script>

    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="/stylesheets/assets/js/vendors/jquery-3.6.0.min.js"></script>
    <script src="/stylesheets/assets/js/vendors/bootstrap.bundle.min.js"></script>
    <script src="/stylesheets/assets/js/vendors/select2.min.js"></script>
    <script src="/stylesheets/assets/js/vendors/perfect-scrollbar.js"></script>
    <script src="/stylesheets/assets/js/vendors/jquery.fullscreen.min.js"></script>
    // Main Script
    <script src="/stylesheets/assets/js/main.js" type="text/javascript"></script>
</body>

</html>